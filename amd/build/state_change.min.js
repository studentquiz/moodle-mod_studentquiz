/**
 * Javascript for state change dialog
 *
 * @module    mod_studentquiz/state_change
 * @copyright 2019 HSR (http://www.hsr.ch)
 * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_studentquiz/state_change",["jquery","core/ajax","core/notification","core/str"],(function($,Ajax,Notification,Str){var t={SELECTOR:{STATE_SELECT:"#menustatetype",CHANGE_STATE_BUTTON:"div.singlebutton.continue_state_change [type=submit]",STATE_VALUE_INPUT:"input[name=state]",SUBMIT_STATE_BUTTON:"#change_state",CHANGE_STATE_NOTIFICATION:"span.change-question-state",CURRENT_STATE_TEXT:"div.current-state"},init:function(){let lastSelectedState=$(t.SELECTOR.SUBMIT_STATE_BUTTON).attr("data-currentstate");$(document).on("change",t.SELECTOR.STATE_SELECT,{},(function(){var stateChangeSelect=$(t.SELECTOR.STATE_SELECT),changeStateButton=$(t.SELECTOR.CHANGE_STATE_BUTTON),stateValueInput=$(t.SELECTOR.STATE_VALUE_INPUT),submitStateButton=$(t.SELECTOR.SUBMIT_STATE_BUTTON);""!==stateChangeSelect.val()&&stateChangeSelect.val()!==lastSelectedState?(stateValueInput.val(stateChangeSelect.val()),changeStateButton.removeAttr("disabled"),submitStateButton.removeAttr("disabled")):(changeStateButton.attr("disabled","disabled"),submitStateButton.attr("disabled","disabled"))})),$(document).on("click",t.SELECTOR.SUBMIT_STATE_BUTTON,{},(function(){var stateChangeSelect=$(t.SELECTOR.STATE_SELECT),submitStateButton=$(t.SELECTOR.SUBMIT_STATE_BUTTON);const currentStateText=$(t.SELECTOR.CURRENT_STATE_TEXT);submitStateButton.attr("disabled","disabled");var pendingPromise=t.addPendingJSPromise("studentquizStateChange");require(["core/loadingicon"],(function(LoadingIcon){var parentElement=$(t.SELECTOR.CHANGE_STATE_NOTIFICATION);LoadingIcon.addIconToContainerRemoveOnCompletion(parentElement,pendingPromise)}));var args={courseid:submitStateButton.attr("data-courseid"),cmid:submitStateButton.attr("data-cmid"),studentquizquestionid:submitStateButton.attr("data-studentquizquestionid"),state:stateChangeSelect.val()};Ajax.call([{methodname:"mod_studentquiz_set_state",args:args}],!0,!0)[0].then((function(results){Notification.alert(results.status,results.message),pendingPromise.resolve(),lastSelectedState=stateChangeSelect.val();const currentSelectedText=stateChangeSelect.find("option:selected").text();Str.get_string("changecurrentstate","studentquiz",currentSelectedText).done((newString=>{currentStateText.html(newString)})),window.opener.location.reload()})).fail(undefined)}))},addPendingJSPromise:function(pendingKey){M.util.js_pending(pendingKey);var pendingPromise=$.Deferred();return pendingPromise.then((function(){return M.util.js_complete(pendingKey),arguments[0]})).catch(Notification.exception),pendingPromise}};return t}));

//# sourceMappingURL=state_change.min.js.map